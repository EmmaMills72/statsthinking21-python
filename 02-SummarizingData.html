

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Summarizing Data &#8212; Python Companion to Statistical Thinking in the 21st Century</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Introduction to Python" href="01-IntroductionToPython.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Python Companion to Statistical Thinking in the 21st Century</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="01-IntroductionToPython.html">Introduction to Python</a>
  </li>
  <li class="active">
    <a href="">Summarizing Data</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/02-SummarizingData.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#working-with-data-frames" class="nav-link">Working with data frames</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#selecting-rows-observations-and-columns-variables" class="nav-link">Selecting rows (observations) and columns (variables)</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#missing-values" class="nav-link">Missing values</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#selecting-rows-by-value" class="nav-link">Selecting rows by value</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#creating-new-variables" class="nav-link">Creating new variables</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#understanding-your-data" class="nav-link">Understanding your data</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#summarizing-data-using-a-frequency-distribution" class="nav-link">Summarizing data using a frequency distribution</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#data-cleaning" class="nav-link">Data Cleaning</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="summarizing-data">
<h1>Summarizing Data<a class="headerlink" href="#summarizing-data" title="Permalink to this headline">¶</a></h1>
<p>This chapter will introduce you to how to summarize data using data frames in Pandas.</p>
<p>Before doing anything else we need to import the packages that we will use in this chapter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="working-with-data-frames">
<h2>Working with data frames<a class="headerlink" href="#working-with-data-frames" title="Permalink to this headline">¶</a></h2>
<p>In the last chapter you were introduced to the concept of a <em>data frame</em>, which we will use throughout much of this book.<br />
In particular, we will use a dataset known as <a class="reference external" href="https://www.cdc.gov/nchs/nhanes/index.htm">NHANES</a> for several of our examples, so let’s load the library that provides us access to the data.
This is a large dataset collected from a sample of individuals in the United States every two years, which measures many different aspects of their health and lifestyles.
To access the data, we will use a Python package called <a class="reference external" href="https://github.com/poldrack/nhanes">nhanes</a> that contains a function to load a cleaned-up version of the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nhanes.load</span> <span class="kn">import</span> <span class="n">load_NHANES_data</span>
<span class="n">nhanes_data</span> <span class="o">=</span> <span class="n">load_NHANES_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">.head()</span></code> method to look inside the data frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the structure of this dataset.  We can see the <em>shape</em> of the data frame – that is, the number of rows and columns – using the <code class="docutils literal notranslate"><span class="pre">.shape</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<p>We see that the dataset has many more rows than columns. Let’s look more closely at what is contained in the rows and columns.  To obtain the labels for the rows, we use the <code class="docutils literal notranslate"><span class="pre">.index</span></code> operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<p>The index contains a bunch of numbers, each of which refers to one of the individuals in the NHANES data set.  In a data frame, the rows always refer to <em>observations</em>, by which mean that each row reflects an individual unit of data.  In the case of a dataset like NHANES, the observations would usually refer to individual people, though as we will see later, we sometimes want the rows to be even more specific.
We can also look at the content of the columns, which we can access using the <code class="docutils literal notranslate"><span class="pre">.columns</span></code> operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<p>Each of the columns contains a different <em>variable</em> – that is, a different thing that is measured on each observation.</p>
<div class="section" id="selecting-rows-observations-and-columns-variables">
<h3>Selecting rows (observations) and columns (variables)<a class="headerlink" href="#selecting-rows-observations-and-columns-variables" title="Permalink to this headline">¶</a></h3>
<p>We often want to select a subset of rows from a data frame. You saw in the last chapter how we can access specific rows using the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> operator.  This operator requires us to refer to the row names (that is, the <em>index</em>) and column names.  For example, if we wanted to know the value of the <code class="docutils literal notranslate"><span class="pre">GeneralHealthCondition</span></code> variable for the indivdiual labeled 93707, we could use the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">93707</span><span class="p">,</span> <span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>If there were several variables that we wanted to see for this individual, we could include the names of those variables in a <em>list</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">93707</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender&#39;</span><span class="p">,</span> <span class="s1">&#39;AgeInYearsAtScreening&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>This shows us the values for each of those variables for this individual. We could also do the same if there were several individuals that we were interested in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">102951</span><span class="p">,</span> <span class="mi">102955</span><span class="p">,</span> <span class="mi">93707</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender&#39;</span><span class="p">,</span> <span class="s1">&#39;AgeInYearsAtScreening&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="missing-values">
<h3>Missing values<a class="headerlink" href="#missing-values" title="Permalink to this headline">¶</a></h3>
<p>You will notice that the <code class="docutils literal notranslate"><span class="pre">GeneralHealthCondition</span></code> variable for the first individual in the previous cell contained <em>NaN</em>, which stands for “not a number”.  This is generally used to denote that the data are missing for this particular observation; perhaps they declined to answer the question, or the interviewer failed to properly record the answer.  Missing data are common when we are working with real data.  There are many sophsticated ways to deal with missing data in statistics, but for the moment we will just remove observations that have a missing data on one of our variables of interest, which we can do using the <code class="docutils literal notranslate"><span class="pre">.dropna()</span></code> operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_subset</span> <span class="o">=</span> <span class="n">nhanes_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">102951</span><span class="p">,</span> <span class="mi">102955</span><span class="p">,</span> <span class="mi">93707</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender&#39;</span><span class="p">,</span> <span class="s1">&#39;AgeInYearsAtScreening&#39;</span><span class="p">]]</span>
<span class="n">my_subset</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This operator removes any rows that have missing values for any of the variables in the data frame.</p>
</div>
<div class="section" id="selecting-rows-by-value">
<h3>Selecting rows by value<a class="headerlink" href="#selecting-rows-by-value" title="Permalink to this headline">¶</a></h3>
<p>Let’s say that we want to analyze NHANES data, but only for those individuals who are over 50 years of age.  We can use the <code class="docutils literal notranslate"><span class="pre">query</span></code> operator on a data frame to find rows that match particular conditions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">over_50_df</span> <span class="o">=</span> <span class="n">nhanes_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;AgeInYearsAtScreening &gt;= 50&#39;</span><span class="p">)</span>
<span class="n">over_50_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<p>This shows that there were 2898 observations that matched our criterion.  We can also search for specific values: For example, let’s say that we want to find anyone who reported that their general health condition was “Good”.  This one is a bit tricky, because we are searching for a string of text, which we have to embed in our query, which is also a string of text.  Fortunately, there are two different quotation marks that we can use (<code class="docutils literal notranslate"><span class="pre">'</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>) and Python treats them as distinct operators, so we can surround our text within double quotes, inside a string surrounded by single quotes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">good_health_df</span> <span class="o">=</span> <span class="n">nhanes_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;GeneralHealthCondition == &quot;Good&quot;&#39;</span><span class="p">)</span>
<span class="n">good_health_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="creating-new-variables">
<h2>Creating new variables<a class="headerlink" href="#creating-new-variables" title="Permalink to this headline">¶</a></h2>
<p>We can add a new variable to a data frame easily, by simply giving it a new name. Let’s say that we wanted to convert the weight value in NHANES (stored in the <code class="docutils literal notranslate"><span class="pre">WeightKg</span></code> variable) from kilograms to pounds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;WeightLbs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;WeightLbs&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.205</span>
</pre></div>
</div>
</div>
</div>
<p>This shows another way to refer to a particular variable in a dataframe: simply put its name in square brackets.  Pandas also has the ability to replace particular values in a variable.  First, let’s look at the values of the <code class="docutils literal notranslate"><span class="pre">Gender</span></code> variable in the data frame, to see what values it takes. We can see all of the unique values of a variable using the <code class="docutils literal notranslate"><span class="pre">.unique()</span></code> operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s say that we wanted to recode the <code class="docutils literal notranslate"><span class="pre">Gender</span></code> variable so that instead of “Female” and “Male” its values were “F” and “M”.  One way to do this would be to use the <code class="docutils literal notranslate"><span class="pre">.rename()</span></code> operator on the data frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;GenderMF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;Female&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">})</span>
<span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;GenderMF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="understanding-your-data">
<h3>Understanding your data<a class="headerlink" href="#understanding-your-data" title="Permalink to this headline">¶</a></h3>
<p>Let’s say that we want to learn more about the variable labeled <code class="docutils literal notranslate"><span class="pre">GeneralHealthCondition</span></code> in the dataset.  We can load some information about that variable using the <code class="docutils literal notranslate"><span class="pre">open_variable_page()</span></code> function from the <code class="docutils literal notranslate"><span class="pre">nhanes</span></code> package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nhanes.load</span> <span class="kn">import</span> <span class="n">open_variable_page</span>
<span class="n">open_variable_page</span><span class="p">(</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This shows us the question that was asked (“Would you say {your/SP’s} health in general is…”).</p>
</div>
</div>
<div class="section" id="summarizing-data-using-a-frequency-distribution">
<h2>Summarizing data using a frequency distribution<a class="headerlink" href="#summarizing-data-using-a-frequency-distribution" title="Permalink to this headline">¶</a></h2>
<p>Let’s say that we want to know the frequencies of all of the different answers to the GeneralHealthCondition question.  We can do this using the <code class="docutils literal notranslate"><span class="pre">.value_counts()</span></code> method of the data frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>It’s usually more helpful to present a <em>relative frequency distribution</em>, which shows proportions rather than counts.  We can obtain that by simply dividing the frequency distribution by the total number of cases, which we can obtain using the <code class="docutils literal notranslate"><span class="pre">.sum()</span></code> operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GeneralHealthCondition_frequency_dist</span> <span class="o">=</span> <span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">GeneralHealthCondition_frequency_dist</span> <span class="o">/</span> <span class="n">GeneralHealthCondition_frequency_dist</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-cleaning">
<h3>Data Cleaning<a class="headerlink" href="#data-cleaning" title="Permalink to this headline">¶</a></h3>
<p>When we work with real data, they often have problems that we have to fix before we can analyze them properly.  An example is the <code class="docutils literal notranslate"><span class="pre">GeneralHealthCondition</span></code> variable that we worked with in the previous example. You may have noticed that the values of the variable had some extranous information, which were held over from the way that the question is worded (including “Fair or” and “Poor?”).  We can clean these up by replacing the problematic values using the <code class="docutils literal notranslate"><span class="pre">.replace()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;GeneralHealthConditionFixed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;GeneralHealthCondition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;Fair or&#39;</span><span class="p">:</span> <span class="s1">&#39;Fair&#39;</span><span class="p">,</span> <span class="s1">&#39;Poor?&#39;</span><span class="p">:</span> <span class="s1">&#39;Poor&#39;</span><span class="p">})</span>
<span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;GeneralHealthConditionFixed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s look at a more complex example.  Let’s say that we want to know who is currently a smokker in the NHANES sample.  If we look more closely at the <a class="reference external" href="https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/SMQ_J.htm">details of the smoking questionnaire</a>, we will see that not all individuals got the same questions; for example, if a person said that they had not smoked more than 100 cigarettes in their life (recorded in the <code class="docutils literal notranslate"><span class="pre">SmokedAtLeast100CigarettesInLife</span></code> variable), then they were not asked the question about whether they currently smoked cigarettes (stored as <code class="docutils literal notranslate"><span class="pre">DoYouNowSmokeCigarettes</span></code>).  We can see this in the number of respondents to each question:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;SmokedAtLeast100CigarettesInLife&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="p">[</span><span class="s1">&#39;DoYouNowSmokeCigarettes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Looking at these two variables, it’s plain to see that there are many more values included in the first question than in the second. Let’s look at bit more closely at the data to see what’s going on:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_data</span><span class="p">[[</span><span class="s1">&#39;SmokedAtLeast100CigarettesInLife&#39;</span><span class="p">,</span> <span class="s1">&#39;DoYouNowSmokeCigarettes&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here we can see that anyone who said No to the question about having smoked at least 100 cigarettes in their life (which is coded as zero) has a missing value for the question about current smoking (since that question wasn’t asked to these individuals).  To clean up these data, we need to do two things. First, we need to remove the individuals who have NaN for both questions, then we need to recode the NaN’s for the second question for those people who said no on the first question.  To do this, let’s first create a new data frame that contains just the variables we are interested in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">smoking_df</span> <span class="o">=</span> <span class="n">nhanes_data</span><span class="p">[[</span><span class="s1">&#39;SmokedAtLeast100CigarettesInLife&#39;</span><span class="p">,</span> <span class="s1">&#39;DoYouNowSmokeCigarettes&#39;</span><span class="p">]]</span>
<span class="n">smoking_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<p>First let’s remove any rows that have NaN in both columns. We can do this using the <code class="docutils literal notranslate"><span class="pre">.dropna()</span></code> method, which has an option that allows us to specify that we only drop rows that are all NaN (by setting <code class="docutils literal notranslate"><span class="pre">how='all'</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">smoking_df</span> <span class="o">=</span> <span class="n">smoking_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">smoking_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<p>Next we need to recode the NaN values for the second question, for those individuals who said no to the first question.  We will replace them with the answer ‘Not at all’.  To do this, we can use the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> operator with a test for the value of the first column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">smoking_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">smoking_df</span><span class="p">[</span><span class="s1">&#39;SmokedAtLeast100CigarettesInLife&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;DoYouNowSmokeCigarettes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Not at all&#39;</span>
<span class="n">smoking_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This replaced the NaN values in the second question, but only for those individuals who said no to the first question.  Now we can summarize the frequency of smoking across the entire group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">smoking_df</span><span class="p">[</span><span class="s1">&#39;DoYouNowSmokeCigarettes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="n">smoking_df</span><span class="p">[</span><span class="s1">&#39;DoYouNowSmokeCigarettes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">chapter</span> <span class="n">you</span> <span class="n">will</span> <span class="n">learn</span> <span class="n">how</span> <span class="n">to</span> <span class="n">visualize</span> <span class="n">data</span> <span class="n">like</span> <span class="n">these</span> <span class="n">using</span> <span class="n">statistical</span> <span class="n">graphs</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="01-IntroductionToPython.html" title="previous page">Introduction to Python</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Russell A. Poldrack<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>